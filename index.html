 {
    constructor(token, databaseId) {
        this.token = token;
        this.databaseId = databaseId;
        this.baseURL = 'https://api.notion.com/v1';
    }

    async syncTaskToNotion(task, category, completed) {
        const headers = {
            'Authorization': `Bearer ${this.token}`,
            'Notion-Version': '2022-06-28',
            'Content-Type': 'application/json'
        };

        const data = {
            parent: { database_id: this.databaseId },
            properties: {
                'Task': {
                    title: [{ text: { content: task } }]
                },
                'Category': {
                    select: { name: category }
                },
                'Completed': {
                    checkbox: completed
                },
                'Date': {
                    date: { start: new Date().toISOString().split('T')[0] }
                },
                'Progress': {
                    number: this.calculateCategoryProgress(category)
                }
            }
        };

        try {
            const response = await fetch(`${this.baseURL}/pages`, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                console.log('âœ… Task synced to Notion:', task);
                this.showSyncSuccess();
            }
        } catch (error) {
            console.error('Notion sync failed:', error);
        }
    }

    async exportDailyProgress() {
        const progressData = {
            date: new Date().toISOString().split('T')[0],
            business: appData.load('progress-business') || 0,
            health: appData.load('progress-health') || 0,
            spanish: appData.load('progress-spanish') || 0,
            social: appData.load('progress-social') || 0,
            totalTasks: this.getTotalCompletedTasks(),
            streak: calculateCurrentStreak()
        };

        // Create daily progress entry in Notion
        await this.createProgressEntry(progressData);
        return progressData;
    }

    calculateCategoryProgress(category) {
        return appData.load(`progress-${category}`) || 0;
    }

    getTotalCompletedTasks() {
        let total = 0;
        document.querySelectorAll('.checkbox-item.completed').forEach(() => total++);
        return total;
    }

    showSyncSuccess() {
        const indicator = document.createElement('div');
        indicator.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #0369a1;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        `;
        indicator.textContent = 'âœ… Synced to Notion!';
        document.body.appendChild(indicator);
        
        setTimeout(() => {
            if (indicator.parentNode) {
                document.body.removeChild(indicator);
            }
        }, 3000);
    }
}

// Initialize Notion integration (add your credentials)
const notionIntegration = new NotionIntegration(
    'YOUR_NOTION_TOKEN',    // Get from: https://www.notion.so/my-integrations
    'YOUR_DATABASE_ID'      // Your Notion database ID
);

// Enhanced task toggle with Notion sync
function toggleTaskWithNotion(element, category) {
    // Original toggle functionality
    toggleTask(element, category);
    
    // Sync to Notion if integration is set up
    if (notionIntegration.token && notionIntegration.databaseId) {
        const taskText = element.textContent.trim();
        const isCompleted = element.classList.contains('completed');
        notionIntegration.syncTaskToNotion(taskText, category, isCompleted);
    }
}

// Auto-sync button for manual exports
function addNotionSyncButton() {
    const syncButton = document.createElement('button');
    syncButton.textContent = 'ðŸ”„ Sync to Notion';
    syncButton.style.cssText = `
        background: #0369a1;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.9rem;
        margin-left: 10px;
    `;
    
    syncButton.onclick = async () => {
        syncButton.textContent = 'â³ Syncing...';
        await notionIntegration.exportDailyProgress();
        syncButton.textContent = 'âœ… Synced!';
        setTimeout(() => {
            syncButton.textContent = 'ðŸ”„ Sync to Notion';
        }, 2000);
    };
    
    // Add button next to existing export button
    const exportButton = document.querySelector('button[onclick="exportToNotion()"]');
    if (exportButton && exportButton.parentNode) {
        exportButton.parentNode.insertBefore(syncButton, exportButton.nextSibling);
    }
}
